<!doctype html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />
<title>Collaboration Values - Interactive Radial View</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div id="container">
  <div id="center-node">STA</div>
</div>

<script>
let collaborationValues = [];
let centerContent = {};

// Load data from JSON file
async function loadData() {
  try {
    const response = await fetch('data.json');
    const data = await response.json();
    collaborationValues = data.values;
    centerContent = data.centerContent;
    
    // Initialize the radial layout after data is loaded
    new RadialLayout();
  } catch (error) {
    console.error('Error loading data:', error);
    // Fallback to default data if JSON loading fails
    collaborationValues = [
      {
        id: 'method-mission',
        title: 'ðŸ“‹ Method with Mission',
        position: 0,
        dailyWork: ['Working groups align activities with public benefit'],
        skills: ['Project management for mission alignment']
      }
    ];
    new RadialLayout();
  }
}

class RadialLayout {
  constructor() {
    this.container = document.getElementById('container');
    this.centerNode = document.getElementById('center-node');
    this.radius = Math.min(window.innerWidth, window.innerHeight) * 0.25;
    this.centerX = window.innerWidth / 2;
    this.centerY = window.innerHeight / 2;
    this.activeArm = null;
    
    this.init();
  }
  
  init() {
    this.createValueNodes();
    this.createConnectionLines();
    this.setupEventListeners();
    this.centerNode.addEventListener('click', () => this.showCenterDetails());
  }
  
  createValueNodes() {
    collaborationValues.forEach(value => {
      const node = document.createElement('div');
      node.className = 'value-node';
      node.id = value.id;
      node.innerHTML = value.title;
      
      // Calculate position
      const angle = (value.position * Math.PI) / 180;
      const x = this.centerX + this.radius * Math.cos(angle);
      const y = this.centerY + this.radius * Math.sin(angle);
      
      node.style.left = `${x - 100}px`;
      node.style.top = `${y - 100}px`;
      
      node.addEventListener('click', () => this.toggleArm(value));
      
      this.container.appendChild(node);
    });
  }
  
  createConnectionLines() {
    collaborationValues.forEach(value => {
      const line = document.createElement('div');
      line.className = 'connection-line';
      
      const angle = (value.position * Math.PI) / 180;
      const endX = this.centerX + this.radius * Math.cos(angle);
      const endY = this.centerY + this.radius * Math.sin(angle);
      
      const length = Math.sqrt(Math.pow(endX - this.centerX, 2) + Math.pow(endY - this.centerY, 2));
      const angleDeg = (value.position + 90) % 360;
      
      line.style.width = `${length}px`;
      line.style.left = `${this.centerX}px`;
      line.style.top = `${this.centerY}px`;
      line.style.transform = `rotate(${angleDeg}deg)`;
      
      this.container.appendChild(line);
    });
  }
  
  toggleArm(value) {
    // Remove active class from all nodes
    document.querySelectorAll('.value-node').forEach(node => {
      node.classList.remove('active');
    });
    
    // Add active class to clicked node
    document.getElementById(value.id).classList.add('active');
    
    // Close any existing arm
    if (this.activeArm) {
      this.closeArm();
    }
    
    // Create and open new arm
    this.createArm(value);
  }
  
  createArm(value) {
    const arm = document.createElement('div');
    arm.className = 'expanding-arm';
    arm.id = `arm-${value.id}`;
    
    // Calculate position for the arm - extend from center outward
    const angle = (value.position * Math.PI) / 180;
    const armDistance = this.radius + 100; // Distance from center
    const armX = this.centerX + armDistance * Math.cos(angle);
    const armY = this.centerY + armDistance * Math.sin(angle);
    
    // Check if we're on mobile and position accordingly
    const isMobile = window.innerWidth <= 768;
    
    if (isMobile) {
      // On mobile, center the arm
      arm.style.left = '50%';
      arm.style.top = '50%';
      arm.style.transform = 'translate(-50%, -50%)';
    } else {
      // On desktop, position relative to the value node
      arm.style.left = `${armX - 175}px`;
      arm.style.top = `${armY - 125}px`;
    }
    
    arm.innerHTML = `
      <div class="arm-content">
        <div class="arm-header">
          <div class="arm-title">${value.title}</div>
          <button class="close-arm" onclick="this.closest('.expanding-arm').remove(); document.getElementById('connection-' + '${value.id}')?.remove(); document.querySelectorAll('.value-node').forEach(n => n.classList.remove('active'));">Ã—</button>
        </div>
        
        <div class="toggle-buttons">
          <button class="toggle-btn active" data-section="daily-work">How that affects my daily work?</button>
          <button class="toggle-btn" data-section="skills">Building Collaboration Skills</button>
        </div>
        
        <div class="content-section active" id="daily-work-${value.id}">
          <h3>How that affects my daily work?</h3>
          <ul>
            ${value.dailyWork.map(item => `<li>${item}</li>`).join('')}
          </ul>
        </div>
        
        <div class="content-section" id="skills-${value.id}">
          <h3>Building Collaboration Skills</h3>
          <ul>
            ${value.skills.map(item => `<li>${item}</li>`).join('')}
          </ul>
        </div>
      </div>
    `;
    
    this.container.appendChild(arm);
    this.activeArm = arm;
    
    // Create connection line from center to arm (only on desktop)
    if (!isMobile) {
      const connectionLine = document.createElement('div');
      connectionLine.className = 'arm-connection';
      connectionLine.id = `connection-${value.id}`;
      
      // Calculate the connection line to go from center to the arm's edge
      const connectionLength = armDistance - 60; // Length from center to arm edge
      const connectionAngleDeg = value.position; // Use the same angle as the value node
      
      connectionLine.style.width = `${connectionLength}px`;
      connectionLine.style.left = `${this.centerX}px`;
      connectionLine.style.top = `${this.centerY}px`;
      connectionLine.style.transform = `rotate(${connectionAngleDeg}deg)`;
      
      this.container.appendChild(connectionLine);
    }
    
    // Add toggle button functionality
    setTimeout(() => {
      arm.classList.add('open');
      
      const toggleBtns = arm.querySelectorAll('.toggle-btn');
      toggleBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          // Remove active class from all buttons
          toggleBtns.forEach(b => b.classList.remove('active'));
          // Add active class to clicked button
          btn.classList.add('active');
          
          // Hide all content sections
          arm.querySelectorAll('.content-section').forEach(section => {
            section.classList.remove('active');
          });
          
          // Show selected content section
          const sectionId = btn.dataset.section + '-' + value.id;
          document.getElementById(sectionId).classList.add('active');
        });
      });
    }, 10);
  }
  
  closeArm() {
    if (this.activeArm) {
      const armId = this.activeArm.id;
      const connectionId = `connection-${armId.replace('arm-', '')}`;
      
      this.activeArm.remove();
      const connection = document.getElementById(connectionId);
      if (connection) connection.remove();
      
      this.activeArm = null;
    }
  }
  
  showCenterDetails() {
    // Close any existing arm
    this.closeArm();
    
    // Remove active class from all nodes
    document.querySelectorAll('.value-node').forEach(node => {
      node.classList.remove('active');
    });
    
    // Create center arm
    const arm = document.createElement('div');
    arm.className = 'expanding-arm';
    arm.id = 'center-arm';
    
    arm.style.left = `${this.centerX - 175}px`;
    arm.style.top = `${this.centerY - 125}px`;
    
    const overview = centerContent.overview || {
      title: 'Collaboration Values Overview',
      description: 'This interactive visualization shows the core collaboration values.',
      instructions: 'Click on any value around the circle to explore:',
      features: ['How each value affects daily work', 'Skills needed to build collaboration']
    };
    
    arm.innerHTML = `
      <div class="arm-content">
        <div class="arm-header">
          <div class="arm-title">STA - Collaboration Values</div>
          <button class="close-arm" onclick="this.closest('.expanding-arm').remove();">Ã—</button>
        </div>
        
        <div class="toggle-buttons">
          <button class="toggle-btn active" data-section="overview">Overview</button>
          <button class="toggle-btn" data-section="values">All Values</button>
        </div>
        
        <div class="content-section active" id="overview">
          <h3>${overview.title}</h3>
          <p>${overview.description}</p>
          <p>${overview.instructions}</p>
          <ul>
            ${overview.features.map(feature => `<li>${feature}</li>`).join('')}
          </ul>
        </div>
        
        <div class="content-section" id="values">
          <h3>${centerContent.values?.title || 'All Collaboration Values'}</h3>
          <ul>
            ${collaborationValues.map(v => `<li>${v.title}</li>`).join('')}
          </ul>
        </div>
      </div>
    `;
    
    this.container.appendChild(arm);
    this.activeArm = arm;
    
    setTimeout(() => {
      arm.classList.add('open');
      
      const toggleBtns = arm.querySelectorAll('.toggle-btn');
      toggleBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          toggleBtns.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          
          arm.querySelectorAll('.content-section').forEach(section => {
            section.classList.remove('active');
          });
          
          const sectionId = btn.dataset.section;
          document.getElementById(sectionId).classList.add('active');
        });
      });
    }, 10);
  }
  
  setupEventListeners() {
    // Handle window resize
    window.addEventListener('resize', () => {
      this.radius = Math.min(window.innerWidth, window.innerHeight) * 0.25;
      this.centerX = window.innerWidth / 2;
      this.centerY = window.innerHeight / 2;
      this.updatePositions();
    });
  }
  
  updatePositions() {
    collaborationValues.forEach(value => {
      const node = document.getElementById(value.id);
      if (node) {
        const angle = (value.position * Math.PI) / 180;
        const x = this.centerX + this.radius * Math.cos(angle);
        const y = this.centerY + this.radius * Math.sin(angle);
        
        node.style.left = `${x - 100}px`;
        node.style.top = `${y - 100}px`;
      }
    });
    
    // Update connection lines
    document.querySelectorAll('.connection-line').forEach((line, index) => {
      const value = collaborationValues[index];
      const angle = (value.position * Math.PI) / 180;
      const endX = this.centerX + this.radius * Math.cos(angle);
      const endY = this.centerY + this.radius * Math.sin(angle);
      
      const length = Math.sqrt(Math.pow(endX - this.centerX, 2) + Math.pow(endY - this.centerY, 2));
      const angleDeg = (value.position + 90) % 360;
      
      line.style.width = `${length}px`;
      line.style.left = `${this.centerX}px`;
      line.style.top = `${this.centerY}px`;
      line.style.transform = `rotate(${angleDeg}deg)`;
    });
  }
}

// Load data and initialize when the page loads
document.addEventListener('DOMContentLoaded', loadData);
</script>
</body>
</html>
